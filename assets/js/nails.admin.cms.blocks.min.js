var NAILS_Admin_CMS_Blocks;NAILS_Admin_CMS_Blocks=function(){this.new_counter=0;this.block_type="plaintext";this.init_search=function(){var e=this;$(".search-text input").on("keyup",function(){e._do_search($(this).val());return!1})};this._do_search=function(e){$("tr.block").each(function(){var t=new RegExp(e,"gi");t.test($(this).attr("data-title"))?$(this).show():$(this).hide()})};this.init_create=function(){this._init_type_change()};this._init_type_change=function(){$("select[name=type]").on("change",$.proxy(function(){this._type_changed()},this));this._type_changed()};this._type_changed=function(){var e=$("select[name=type]").val();switch(e){case"plaintext":$("#default-value").show();$("#ckeditor-warn").hide();typeof CKEDITOR.instances.default_value!="undefined"&&CKEDITOR.instances.default_value.destroy();break;case"richtext":$("#default-value").show();$("#ckeditor-warn").show();CKEDITOR.replace("default_value");break;default:$("#default-value").hide();$("#ckeditor-warn").hide();typeof CKEDITOR.instances.default_value!="undefined"&&CKEDITOR.instances.default_value.destroy()}};this.init_edit=function(e){this.block_type=e;this._init_new_translation();this._init_del_translation();this._init_toggle_revision();this._init_form_validation();var t=this;$(document).on("change",".translation select",function(){t._lang_change($(this));return!1})};this._init_new_translation=function(){$("#new-translation").on("click",$.proxy(function(){this._add_translation();return!1},this))};this._add_translation=function(){var e={new_count:this.new_counter},t=$("#template-translation").html(),n=$("<fieldset>").addClass("translation");n.html(Mustache.render(t,e));n.attr("data-translation_id",this.new_counter).find("select").prepend($("<option>").attr({value:"",selected:"selected","class":"please-choose",disabled:"disabled"}).text("Please Choose Language..."));$(".translation").last().after(n);this._lang_disable();this.block_type==="richtext"&&CKEDITOR.replace("translation_"+this.new_counter);this.new_counter++};this._init_del_translation=function(){var e=this;$(document).on("click","a.remove-translation",function(){e._del_translation($(this));return!1})};this._del_translation=function(e){if(this.block_type==="richtext"){var t=e.closest("fieldset").attr("data-translation_id");t="translation_"+t;CKEDITOR.instances[t].destroy()}e.closest("fieldset").remove()};this._lang_change=function(e){e.closest("fieldset").attr("data-lang_id",e.val());this._lang_disable()};this._lang_disable=function(){$(".translation option[disabled=disabled]:not(.please-choose)").removeAttr("disabled");$(".translation").each(function(){$(".translation option[value="+$(this).attr("data-lang_id")+"]").attr("disabled","disabled");$("option[value="+$(this).attr("data-lang_id")+"]",this).removeAttr("disabled")});$(".translation option[selected=selected]:not(.please-choose)").removeAttr("disabled")};this._init_toggle_revision=function(){var e=this;$("a.toggle-revisions").on("click",function(){e._toggle_revision($(this));return!1})};this._toggle_revision=function(e){e.closest(".revisions").toggleClass("show")};this._init_form_validation=function(){var e=this;$("form").on("submit",function(){return e._form_validation()})};this._form_validation=function(){var e=0;$("fieldset.translation").each(function(){var t;$("select",this).length?t=$("select",this).val():t=!0;var n=$("textarea",this).val();if(!t||!n){e++;$(".system-alert",this).show()}else $(".system-alert",this).hide()});if(e){var t=$("div.system-alert.error:visible").get(0);$.scrollTo(t,"fast",{axis:"y",offset:{top:-50}});return!1}return!0}};