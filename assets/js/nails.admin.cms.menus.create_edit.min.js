var NAILS_Admin_CMS_Menus_Create_Edit;NAILS_Admin_CMS_Menus_Create_Edit=function(){this._item_template="";this._id_length=32;this.init=function(e){var t=this;this._item_template=$("#template-item").html();$("div.nested-sortable").each(function(){var n,r;n=$(this).children("ol.nested-sortable").first();for(var i in e){e[i].counter=$("li.target").length;r=Mustache.render(t._item_template,e[i]);var s;e[i].parent_id!==null&&e[i].parent_id!==""?s=$("li.target-"+e[i].parent_id+" ol.nested-sortable-sub").first():s=n;s.append(r)}n.nestedSortable({handle:"div.handle",items:"li",toleranceElement:"> div",stop:function(){t._update_orders(n);t._update_parent_ids(n)}});$(this).find("a.add-item").on("click",function(){var e={id:t._generate_id(),counter:$("li.target").length},r=Mustache.render(t._item_template,e);n.append(r);t._update_orders();return!1})});$(document).on("click","a.item-remove",function(){var e=$(this);$("<div>").html('<p>This will remove this menu item (and any children) from the interface.</p><p>You will still need to "Save Changes" to commit the removal</p>').dialog({title:"Are you sure?",resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{OK:function(){e.closest("li.target").remove();$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}).show();return!1})};this._update_orders=function(e){var t=0;$("input.input-order",e).each(function(){$(this).val(t);t++})};this._update_parent_ids=function(e){$("input.input-parent_id",e).each(function(){var e=$(this).closest("ol").closest("li").data("id");$(this).val(e)})};this._generate_id=function(){var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t;do{t="newid-";for(var n=this._id_length;n>0;--n)t+=e[Math.round(Math.random()*(e.length-1))]}while($("li.target-"+t).length>0);return t}};