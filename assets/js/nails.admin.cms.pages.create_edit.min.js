var NAILS_Admin_CMS_pages_Create_Edit;NAILS_Admin_CMS_pages_Create_Edit=function(){this.editor_id=Math.floor(Math.random()*1e16);this.search_placeholder="Search widget library";this.init=function(){this._template_chooser_init();this._editor_init();console.log(this.editor_id)};this._template_chooser_init=function(){$("label.template").on("click",function(){$("label.template").removeClass("selected");$(this).addClass("selected");var e=$(this).data("template-slug");$("a.launch-editor").hide();$("a.launch-editor.template-"+e).show()})};this._editor_init=function(){var e=this,t=$("<div>").attr("id",this.editor_id).addClass("group-cms pages widgeteditor ready"),n=$("<div>").attr("id",this.editor_id+"-loader").addClass("loader").html('<span class="ion-looping"></span>'),r=$("<ul>").attr("id",this.editor_id+"-header").addClass("header").html($("#template-header").html()),i=$("<ul>").attr("id",this.editor_id+"-widgets").addClass("widgets"),s=$("<li>").attr("id",this.editor_id+"-search").addClass("search").html($("#template-widget-search").html()),o=$("<ul>").attr("id",this.editor_id+"-dropzone").addClass("dropzone empty").html($("#template-dropzone-empty").html());i.append(s);var u,a,f,l=["test1","test2,something,bla","ssh,images,layout"];for(var c=0;c<10;c++){u={name:"Group "+c,group:"group-"+c};a=$("#template-widget-grouping").html();f=Mustache.render(a,u);i.append(i.append(f));for(var h=0;h<5;h++){u={group:"group-"+c,name:"Widget "+h,keywords:l[Math.floor(Math.random()*l.length)]};a=$("#template-widget").html();f=Mustache.render(a,u);i.append(f)}}t.append(n);t.append(r);t.append(i);t.append(o);$("body").append(t);$("a.launch-editor").on("click",function(){var t=$(this).data("template"),n=$(this).data("area");e._editor_launch(t,n);return!1})};this._editor_launch=function(e,t){console.log(e,t);$("#"+this.editor_id).removeClass("ready").show();var n=this;$("body").addClass("noscroll");$("#"+this.editor_id).addClass("ready");$(document).on("keyup",function(e){e.keyCode===27&&n._editor_close()});$("#"+this.editor_id+"-search a.minimiser").on("click",function(){$("#"+n.editor_id).toggleClass("minimised")});$("#"+this.editor_id+"-search input").on("keyup",function(){var e=$.trim($(this).val());e.length>0?$("#"+n.editor_id+"-widgets li.widget").each(function(){var t=$(this).data("keywords").split(","),n=new RegExp(e,"gi");if(n.test(t)){$(this).addClass("search-hit");$(this).removeClass("search-miss")}else{$(this).addClass("search-miss");$(this).removeClass("search-hit")}}):$("#"+n.editor_id+"-widgets li.widget").removeClass("search-miss search-hit")});$("#"+this.editor_id+"-widgets li.grouping").on("click",function(){$(this).toggleClass("open");var e=$(this).data("group");$("#"+n.editor_id+"-widgets li.widget."+e).toggleClass("hidden")});$("#"+this.editor_id+"-header ul.rhs a").on("click",function(){var e=$(this).data("action");switch(e){case"close":n._editor_close()}return!1})};this._editor_close=function(){$("#"+this.editor_id).hide();$("body").removeClass("noscroll");$(document).off("keyup");$("#"+this.editor_id+"-search a.minimiser").off("click");$("#"+this.editor_id+"-search input").off("keyup");$("#"+this.editor_id+"-widgets li.grouping").off("click");$("#"+this.editor_id+"-header ul.rhs a").off("click")}};