var NAILS_Admin_Blog_Create_Edit;NAILS_Admin_Blog_Create_Edit=function(){this.init=function(e,t){this.mode=e;this.upload_token=t;this._init_chosens();this._init_submit()};this._init_chosens=function(){var e=this,t={},n={};t.categories="#tab-categories select.categories";n.categories=SITE_URL+"admin/blog/manage/categories?mode="+e.mode+"&is_fancybox=1";t.tags="#tab-tags select.tags";n.tags=SITE_URL+"admin/blog/manage/tags?mode="+e.mode+"&is_fancybox=1";t.associations="#tab-associations select";$(t.categories).chosen({footer_html:'<a href="#" class="manage-categories">Manage Categories</a>',width:"100%"});$(t.tags).chosen({footer_html:'<a href="#" class="manage-tags">Manage Tags</a>',width:"100%"});$(t.associations).chosen({width:"100%"});$(document).on("click","a.manage-categories",function(){$.fancybox.open(n.categories,{type:"iframe",beforeClose:function(){e._rebuild_chosen(t.categories)}});return!1});$(document).on("click","a.manage-tags",function(){$.fancybox.open(n.tags,{type:"iframe",beforeClose:function(){e._rebuild_chosen(t.tags)}});return!1});$("ul.tabs a:not(.disabled)").on("click",function(){setTimeout(function(){$(t.categories).trigger("chosen:updated");$(t.tags).trigger("chosen:updated");$(t.associations).trigger("chosen:updated")},1)})};this._rebuild_chosen=function(e){var t=$(".fancybox-iframe").get(0).contentWindow._DATA;if(typeof t=="undefined")return!1;var n=$(e);if(!n.length)return!1;n.each(function(){var e=this,n=[];$("option:selected",this).each(function(){n.push(parseInt($(this).val(),10))});$(this).empty();$.each(t,function(){var t=$("<option>");t.val(this.id);t.html(this.label);$.inArray(this.id,n)>-1&&t.prop("selected",!0);$(e).append(t)});$(this).trigger("chosen:updated")})};this._init_submit=function(){$("#post-form").on("submit",$.proxy(function(){return this._submit()},this))};this._submit=function(){var e=$("#post-form"),t=0;$("ul.tabs li a.error, div.field.error").removeClass("error");$("#body-error").hide();var n={required:"This field is required"};if(!$("input[name=title]",e).val().length){t++;$("#tabber-meta").addClass("error");$("input[name=title]",e).closest("div.field").addClass("error");$("input[name=title]",e).closest("div.field").find("span.error").text(n.required)}if(!$("textarea[name=excerpt]",e).val().length){t++;$("#tabber-meta").addClass("error");$("textarea[name=excerpt]",e).closest("div.field").addClass("error");$("textarea[name=excerpt]",e).closest("div.field").find("span.error").text(n.required)}if(!$("textarea[name=body]",e).val().length){t++;$("#tabber-body").addClass("error");$("textarea[name=body]",e).closest("div.field").addClass("error");$("textarea[name=body]",e).closest("div.field").find("span.error").text(n.required)}if(!$("textarea[name=seo_description]",e).val().length){t++;$("#tabber-seo").addClass("error");$("#body-error").show().text(n.required)}if(!$("input[name=seo_keywords]",e).val().length){t++;$("#tabber-seo").addClass("error");$("input[name=seo_keywords]",e).closest("div.field").addClass("error");$("input[name=seo_keywords]",e).closest("div.field").find("span.error").text(n.required)}if(t){$("ul.tabs a.error").first().click();return!1}return!0}};