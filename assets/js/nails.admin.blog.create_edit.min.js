var NAILS_Admin_Blog_Create_Edit;NAILS_Admin_Blog_Create_Edit=function(){this.init=function(e,t){this.mode=e,this.upload_token=t,this._init_chosens(),this._init_submit()},this._init_chosens=function(){var e=this,t={},i={};t.categories="#tab-categories select.categories",i.categories=SITE_URL+"admin/blog/manage/categories?mode="+e.mode+"&is_fancybox=1",t.tags="#tab-tags select.tags",i.tags=SITE_URL+"admin/blog/manage/tags?mode="+e.mode+"&is_fancybox=1",t.associations="#tab-associations select",$(t.categories).chosen({footer_html:'<a href="#" class="manage-categories">Manage Categories</a>',width:"100%"}),$(t.tags).chosen({footer_html:'<a href="#" class="manage-tags">Manage Tags</a>',width:"100%"}),$(t.associations).chosen({width:"100%"}),$(document).on("click","a.manage-categories",function(){return $.fancybox.open(i.categories,{type:"iframe",beforeClose:function(){e._rebuild_chosen(t.categories)}}),!1}),$(document).on("click","a.manage-tags",function(){return $.fancybox.open(i.tags,{type:"iframe",beforeClose:function(){e._rebuild_chosen(t.tags)}}),!1}),$("ul.tabs a:not(.disabled)").on("click",function(){setTimeout(function(){$(t.categories).trigger("chosen:updated"),$(t.tags).trigger("chosen:updated"),$(t.associations).trigger("chosen:updated")},1)})},this._rebuild_chosen=function(e){var t=$(".fancybox-iframe").get(0).contentWindow._DATA;if("undefined"==typeof t)return!1;var i=$(e);return i.length?void i.each(function(){var e=this,i=[];$("option:selected",this).each(function(){i.push(parseInt($(this).val(),10))}),$(this).empty(),$.each(t,function(){var t=$("<option>");t.val(this.id),t.html(this.label),$.inArray(this.id,i)>-1&&t.prop("selected",!0),$(e).append(t)}),$(this).trigger("chosen:updated")}):!1},this._init_submit=function(){$("#post-form").on("submit",$.proxy(function(){return this._submit()},this))},this._submit=function(){var e=$("#post-form"),t=0;$("ul.tabs li a.error,div.field.error").removeClass("error"),$("div.field.error span.error").remove(),$("#body-error").hide();var i={required:'<span class="error">This field is required</span>'};$("input[name=title]",e).val().length||(t++,$("#tabber-meta").addClass("error"),$("input[name=title]",e).closest("div.field").addClass("error"),$("input[name=title]",e).closest("div.field").find("span.input").append(i.required));var a;return a="object"==typeof CKEDITOR?CKEDITOR.instances.post_body.getData().length:$("textarea[name=body]",e).val().length,a||(t++,$("#tabber-body").addClass("error"),$("textarea[name=body]",e).closest("div.field").addClass("error"),$("textarea[name=body]",e).closest("div.field").find("span.input").append(i.required)),t?($("ul.tabs a.error").first().click(),!1):!0;return t?!1:!0}};