var NAILS_Admin_CMS_Pages_Editor;NAILS_Admin_CMS_Pages_Editor=function(){this.counter=0;this.area="";this.container=null;this.init=function(e){this.area=e;this.container=$("#cms-page-edit-"+e);this._init_draggables();this._init_deletes()};this._init_draggables=function(){var e=this;$("li.widget",this.container).draggable({connectToSortable:"#cms-page-edit-"+this.area+" ul.holders",helper:"clone"});$("ul.holders",this.container).sortable({handle:".handle",placeholder:"holder target",start:function(e,t){var n="start_"+$(t.item).attr("data-template");typeof window[n]=="function"&&window[n].call()},stop:function(t,n){var r=$(n.item).attr("data-template");e._widget_dropped(t,n,r);var i="stop_"+r;typeof window[i]=="function"&&window[i].call()}})};this._widget_dropped=function(e,t,n){if(t.item.hasClass("holder"))return!0;$("#cms-page-edit-"+this.area+" ul.holders").removeClass("empty");var r={key:this.area,counter:this.counter};this.counter++;var i=$("<li>").addClass("holder "+n).attr("data-template",n),s=$("#"+n).html();i.html(Mustache.render(s,r));t.item.replaceWith(i)};this._init_deletes=function(){var e=this;$(document).on("click","#cms-page-edit-"+this.area+" .holder a.close",function(){var t=$(this);$("<div>").text("If you continue, the widget will be removed from the interface. You will need to save changes to commit the deletion.").dialog({title:"Are you sure?",resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{"Delete Widget":function(){t.closest("li.holder").remove();$("#cms-page-edit-"+e.area+" li.holder").length===0?$("#cms-page-edit-"+e.area+" ul.holders").addClass("empty"):$("#cms-page-edit-"+e.area+" ul.holders").removeClass("empty");$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}});return!1})}};