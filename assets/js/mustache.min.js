!function(t,e){"object"==typeof exports&&exports?module.exports=e:"function"==typeof define&&define.amd?define(e):t.Mustache=e}(this,function(){function t(t,e){return RegExp.prototype.test.call(t,e)}function e(e){return!t(g,e)}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function r(t){return String(t).replace(/[&<>"'\/]/g,function(t){return y[t]})}function i(t){this.string=t,this.tail=t,this.pos=0}function o(t,e){this.view=t,this.parent=e,this._cache={}}function a(){this.clearCache()}function s(t,e,n,r){for(var i="",o,a,c,l=0,p=t.length;p>l;++l)switch(o=t[l],a=o[1],o[0]){case"#":if(c=n.lookup(a),"object"==typeof c)if(d(c))for(var h=0,f=c.length;f>h;++h)i+=s(o[4],e,n.push(c[h]),r);else c&&(i+=s(o[4],e,n.push(c),r));else if("function"==typeof c){var g=null==r?null:r.slice(o[3],o[5]);c=c.call(n.view,g,function(t){return e.render(t,n)}),null!=c&&(i+=c)}else c&&(i+=s(o[4],e,n,r));break;case"^":c=n.lookup(a),(!c||d(c)&&0===c.length)&&(i+=s(o[4],e,n,r));break;case">":c=e.getPartial(a),"function"==typeof c&&(i+=c(n));break;case"&":c=n.lookup(a),null!=c&&(i+=c);break;case"name":c=n.lookup(a),null!=c&&(i+=u.escape(c));break;case"text":i+=a}return i}function c(t){for(var e=[],n=e,r=[],i,o=0,a=t.length;a>o;++o)switch(i=t[o],i[0]){case"#":case"^":r.push(i),n.push(i),n=i[4]=[];break;case"/":var s=r.pop();s[5]=i[2],n=r.length>0?r[r.length-1][4]:e;break;default:n.push(i)}return e}function l(t){for(var e=[],n,r,i=0,o=t.length;o>i;++i)n=t[i],n&&("text"===n[0]&&r&&"text"===r[0]?(r[1]+=n[1],r[3]=n[3]):(r=n,e.push(n)));return e}function p(t){return[new RegExp(n(t[0])+"\\s*"),new RegExp("\\s*"+n(t[1]))]}var u={};u.name="mustache.js",u.version="0.7.2",u.tags=["{{","}}"],u.Scanner=i,u.Context=o,u.Writer=a;var h=/\s*/,f=/\s+/,g=/\S/,v=/\s*=/,w=/\s*\}/,m=/#|\^|\/|>|\{|&|=|!/,d=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};u.escape=r,i.prototype.eos=function(){return""===this.tail},i.prototype.scan=function(t){var e=this.tail.match(t);return e&&0===e.index?(this.tail=this.tail.substring(e[0].length),this.pos+=e[0].length,e[0]):""},i.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return e},o.make=function(t){return t instanceof o?t:new o(t)},o.prototype.push=function(t){return new o(t,this)},o.prototype.lookup=function(t){var e=this._cache[t];if(!e){if("."==t)e=this.view;else for(var n=this;n;){if(t.indexOf(".")>0){e=n.view;for(var r=t.split("."),i=0;e&&i<r.length;)e=e[r[i++]]}else e=n.view[t];if(null!=e)break;n=n.parent}this._cache[t]=e}return"function"==typeof e&&(e=e.call(this.view)),e},a.prototype.clearCache=function(){this._cache={},this._partialCache={}},a.prototype.compile=function(t,e){var n=this._cache[t];if(!n){var r=u.parse(t,e);n=this._cache[t]=this.compileTokens(r,t)}return n},a.prototype.compilePartial=function(t,e,n){var r=this.compile(e,n);return this._partialCache[t]=r,r},a.prototype.getPartial=function(t){return t in this._partialCache||!this._loadPartial||this.compilePartial(t,this._loadPartial(t)),this._partialCache[t]},a.prototype.compileTokens=function(t,e){var n=this;return function(r,i){if(i)if("function"==typeof i)n._loadPartial=i;else for(var a in i)n.compilePartial(a,i[a]);return s(t,n,o.make(r),e)}},a.prototype.render=function(t,e,n){return this.compile(t)(e,n)},u.parse=function(t,r){function o(){if(k&&!b)for(;y.length;)delete d[y.pop()];else y=[];k=!1,b=!1}if(t=t||"",r=r||u.tags,"string"==typeof r&&(r=r.split(f)),2!==r.length)throw new Error("Invalid tags: "+r.join(", "));for(var a=p(r),s=new i(t),g=[],d=[],y=[],k=!1,b=!1,x,_,U,E,P;!s.eos();){if(x=s.pos,U=s.scanUntil(a[0]))for(var C=0,j=U.length;j>C;++C)E=U.charAt(C),e(E)?y.push(d.length):b=!0,d.push(["text",E,x,x+1]),x+=1,"\n"==E&&o();if(!s.scan(a[0]))break;if(k=!0,_=s.scan(m)||"name",s.scan(h),"="===_?(U=s.scanUntil(v),s.scan(v),s.scanUntil(a[1])):"{"===_?(U=s.scanUntil(new RegExp("\\s*"+n("}"+r[1]))),s.scan(w),s.scanUntil(a[1]),_="&"):U=s.scanUntil(a[1]),!s.scan(a[1]))throw new Error("Unclosed tag at "+s.pos);if(P=[_,U,x,s.pos],d.push(P),"#"===_||"^"===_)g.push(P);else if("/"===_){if(0===g.length)throw new Error('Unopened section "'+U+'" at '+x);var A=g.pop();if(A[1]!==U)throw new Error('Unclosed section "'+A[1]+'" at '+x)}else if("name"===_||"{"===_||"&"===_)b=!0;else if("="===_){if(r=U.split(f),2!==r.length)throw new Error("Invalid tags at "+x+": "+r.join(", "));a=p(r)}}var A=g.pop();if(A)throw new Error('Unclosed section "'+A[1]+'" at '+s.pos);return d=l(d),c(d)};var k=new a;return u.clearCache=function(){return k.clearCache()},u.compile=function(t,e){return k.compile(t,e)},u.compilePartial=function(t,e,n){return k.compilePartial(t,e,n)},u.compileTokens=function(t,e){return k.compileTokens(t,e)},u.render=function(t,e,n){return k.render(t,e,n)},u.to_html=function(t,e,n,r){var i=u.render(t,e,n);return"function"!=typeof r?i:void r(i)},u}());